(()=>{"use strict";if(localStorage.getItem("operationsAllDate")){let r=document.querySelector(".list-all-operation");if(r)for(let[n,s]of Object.entries(JSON.parse(localStorage.getItem("operationsAllDate"))).reverse()){let l=`<div class="list-all-operation__wrapper" data-dat="all${n}">\n                        <p class="list-all-operation__date">${n}</p>\n                    </div>`;function i(e){return(new DOMParser).parseFromString(e,"text/html").querySelector(".list-all-operation__wrapper")}r.append(i(l));for(let c=0;c<s.length;c++){let d="";function g(e){return(new DOMParser).parseFromString(e,"text/html").querySelector(".item-category")}d=s[c].comment?`<div class="list-category__item item-category expand-operation">\n                        <div class="item-category__head">\n                            <div class="item-category__icon ${s[c].icon}" style="background-color:${s[c].bg}"></div>\n                            <div class="item-category__info">\n                                <p class="item-category__name">${s[c].title}</p>\n                            </div>\n                            <div class="item-category__total">${s[c].cost} BYN</div>\n                        </div>\n                        <div class="item-category__footer">\n                            <div class="item-category__footer-content">\n                                <div class="item-category__comment-wrapper">\n                                    <div class="item-category__comment-icon"></div>\n                                    <p class="item-category__comment">${s[c].comment}</p>\n                                </div>\n                                <div class="item-category__buttons">\n                                    <button class="item-category__button item-category__button_change">Изменить</button>\n                                    <button class="item-category__button item-category__button_delete">Удалить</button>\n                                </div>\n                            </div>\n                        </div>\n                            </div>`:`<div class="list-category__item item-category expand-operation">\n                        <div class="item-category__head">\n                            <div class="item-category__icon ${s[c].icon}" style="background-color:${s[c].bg}"></div>\n                            <div class="item-category__info">\n                                <p class="item-category__name">${s[c].title}</p>\n                            </div>\n                            <div class="item-category__total">${s[c].cost} BYN</div>\n                        </div>\n                        <div class="item-category__footer">\n                            <div class="item-category__footer-content">\n                                <div class="item-category__buttons">\n                                    <button class="item-category__button item-category__button_change">Изменить</button>\n                                    <button class="item-category__button item-category__button_delete">Удалить</button>\n                                </div>\n                            </div>\n                        </div>\n                            </div>`,document.querySelector(`[data-dat="all${n}"]`).append(g(d))}}}const e=document.getElementById("chartAllOperation"),t=new Chart(e,{type:"bubble",data:{datasets:[]},options:{responsive:!0,plugins:{legend:{display:!1},title:{display:!1}},scales:{x:{type:"time",time:{unit:"day"},ticks:{stepSize:5}},y:{ticks:{stepSize:200}}}}});var a,o;!function(){let e=JSON.parse(localStorage.getItem("operationsAllDate")),a=[];for(let t in e)e[t].forEach((e=>{a.includes(e.title)||a.push(e.title)}));let o={};a.forEach((t=>{o[t]=[];for(let a in e){let r=e[a].reduce(((e,a)=>a.title===t?e+a.cost:e),0);o[t].push(r)}}));let r=[];for(let e of Object.values(o))r.push(e);let n=[];for(let t in e)e[t].forEach((e=>{n.includes(e.bg)||n.push(e.bg)}));let s=[];for(let e of Object.keys(JSON.parse(localStorage.getItem("operationsAllDate")))){let t=e.split(".").reverse();t=t.join("-"),s.push(t)}console.log(s);let l=0;for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++)l+=r[e][t];console.log(r),console.log(l);let i=[];for(let e=0;e<r.length;e++){i.push([]);for(let t=0;t<r[e].length;t++)i[e].push(r[e][t]/l*150)}console.log(i),t.data.labels=s;for(let e=0;e<r.length;e++)t.data.datasets[e]||t.data.datasets.push({label:"Dataset 1",backgroundColor:[],data:[],radius:[]}),t.data.datasets[e].data=r[e],t.data.datasets[e].backgroundColor=n[e],t.data.datasets[e].radius=i[e];t.update()}(),window.addEventListener("click",(function(e){if(e.target.closest(".expand-operation")){let t=e.target.closest(".expand-operation");e.target.closest(".item-category__head")&&(t.querySelector(".item-category__footer").classList.toggle("item-category__footer_act"),t.querySelector(".item-category__head").classList.toggle("item-category__head_act"))}})),window.addEventListener("click",(function(e){e.target.closest(".operation-list__item_expenses .item-category__button_delete")&&function(e){let t=e.closest(".item-category");(function(e){let t=JSON.parse(localStorage.getItem("itemOperationExpenses")).filter((t=>t.index!=e.dataset.index));localStorage.setItem("itemOperationExpenses",JSON.stringify(t))})(t),function(e){let t={};for(let[a,o]of Object.entries(JSON.parse(localStorage.getItem("operationsExpensesDate")))){let r=o.filter((t=>t.index!=e.dataset.index));t[a]=r,0==t[a].length&&delete t[a]}localStorage.setItem("operationsExpensesDate",JSON.stringify(t)),function(e){let t=document.querySelector(".operation-list__item_expenses"),a=document.querySelector(".operation-list__more_expenses");t.querySelectorAll(".list-operation__wrapper").forEach((e=>{e.remove()}));for(let[o,r]of Object.entries(e).reverse()){let n=`<div class="list-operation__wrapper" data-dat="expenses${o}">\n                    <p class="list-operation__date">${o}</p>\n                </div>`;function s(e){return(new DOMParser).parseFromString(e,"text/html").querySelector(".list-operation__wrapper")}t.append(s(n));for(let l=0;l<r.length;l++){let i="";function c(e){return(new DOMParser).parseFromString(e,"text/html").querySelector(".item-category")}i=r[l].comment?`<div class="list-category__item item-category expand-operation" data-index="${r[l].index}">\n                <div class="item-category__head">\n                    <div class="item-category__icon ${r[l].icon}" style="background-color:${r[l].bg}"></div>\n                    <div class="item-category__info">\n                        <p class="item-category__name">${r[l].title}</p>\n                    </div>\n                    <div class="item-category__total">${r[l].cost} BYN</div>\n                </div>\n                <div class="item-category__footer">\n                    <div class="item-category__footer-content">\n                        <div class="item-category__comment-wrapper">\n                            <div class="item-category__comment-icon"></div>\n                            <p class="item-category__comment">${r[l].comment}</p>\n                        </div>\n                        <div class="item-category__buttons">\n                            <button class="item-category__button item-category__button_change">Изменить</button>\n                            <button class="item-category__button item-category__button_delete">Удалить</button>\n                        </div>\n                    </div>\n                </div>\n                    </div>`:`<div class="list-category__item item-category expand-operation" data-index="${r[l].index}">\n                    <div class="item-category__head">\n                        <div class="item-category__icon ${r[l].icon}" style="background-color:${r[l].bg}"></div>\n                        <div class="item-category__info">\n                            <p class="item-category__name">${r[l].title}</p>\n                        </div>\n                        <div class="item-category__total">${r[l].cost} BYN</div>\n                    </div>\n                    <div class="item-category__footer">\n                        <div class="item-category__footer-content">\n                            <div class="item-category__buttons">\n                                <button class="item-category__button item-category__button_change">Изменить</button>\n                                <button class="item-category__button item-category__button_delete">Удалить</button>\n                            </div>\n                        </div>\n                    </div>\n                        </div>`,JSON.parse(localStorage.getItem("itemOperationExpensesSortedByCurrenDate")).length<4?(t.append(s(n)),document.querySelector(`[data-dat="expenses${r[l].date}"]`).append(c(i)),document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`).length>1&&document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`)[document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`).length-1].remove(),a.classList.remove("operation-list__more_act")):(t.append(s(n)),document.querySelector(`[data-dat="expenses${r[l].date}"]`).append(c(i)),document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`).length>1&&document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`)[document.querySelectorAll(`[data-dat="expenses${r[l].date}"]`).length-1].remove(),t.querySelectorAll(".item-category").forEach(((e,t)=>{t>2&&e.remove()})),t.querySelectorAll(".list-operation__wrapper").forEach(((e,t)=>{e.children.length<=1&&e.remove()})),a.classList.add("operation-list__more_act"))}}}(t)}(t),function(e){const t=function(e,t){const[a,o]=t.split("-");return e.filter((e=>{const t=new Date(e.date);return t.getFullYear()===parseInt(a)&&t.getMonth()+1===parseInt(o)}))}(JSON.parse(localStorage.getItem("itemOperationExpenses")),localStorage.getItem("currentDate"));localStorage.setItem("itemOperationExpensesSortedByCurrenDate",JSON.stringify(t))}(),function(){let e=[];e=localStorage.getItem("itemOperationExpensesSortedByCurrenDate")?[...JSON.parse(localStorage.getItem("operations")),...JSON.parse(localStorage.getItem("itemOperationExpensesSortedByCurrenDate"))]:[...JSON.parse(localStorage.getItem("operations"))];const t=e.reduce(((e,t)=>{const a=t.title;return e[a]?e[a].cost+=t.cost:e[a]={...t},e}),{}),a=Object.values(t);if(console.log(a),localStorage.setItem("itemCategoriesExpensesSortedByCurrenDate",JSON.stringify(a)),localStorage.getItem("itemCategoriesExpensesSortedByCurrenDate")){let e=0;document.querySelectorAll(".list-categories_expenses .list-categories__item").forEach(((t,a)=>{t.querySelector(".item-category__total").textContent=`${JSON.parse(localStorage.getItem("itemCategoriesExpensesSortedByCurrenDate"))[a].cost} BYN`,e+=JSON.parse(localStorage.getItem("itemCategoriesExpensesSortedByCurrenDate"))[a].cost,document.querySelector(".slider-categories__total-num").textContent=e}))}}(),function(){let e=[],t=[],o=[];JSON.parse(localStorage.getItem("itemCategoriesExpensesSortedByCurrenDate")).forEach((a=>{e.push(a.title),t.push(a.bg),o.push(a.cost)})),a.data.datasets[0].data=o,a.data.datasets[0].backgroundColor=t,a.update()}(),function(){let e={};localStorage.getItem("operationsExpensesDate")&&(e=JSON.parse(localStorage.getItem("operationsExpensesDate")));let t=[];for(let a in e)e[a].forEach((e=>{t.includes(e.title)||t.push(e.title)}));let a={};t.forEach((t=>{a[t]=[];for(let o in e){let r=e[o].reduce(((e,a)=>a.title===t?e+a.cost:e),0);a[t].push(r)}}));let r=[];for(let e of Object.values(a))r.push(e);let n=[];for(let t in e)e[t].forEach((e=>{n.includes(e.bg)||n.push(e.bg)}));let s=[];for(let e of Object.keys(JSON.parse(localStorage.getItem("operationsExpensesDate")))){let t=e.split(".").reverse();t=t.join("-"),s.push(t)}o.data.datasets=[],o.data.labels=s;for(let e=0;e<n.length;e++)o.data.datasets[e]||o.data.datasets.push({type:"bar",label:"Dataset 1",backgroundColor:[],data:[]}),o.data.datasets[e].data=r[e],o.data.datasets[e].backgroundColor=n[e];o.update(),localStorage.setItem("objOfBgOfOperationsExpenses",JSON.stringify(n)),localStorage.setItem("arrOfCostsOfOperationsExpenses",JSON.stringify(r))}(),function(){let e=(t=JSON.parse(localStorage.getItem("operationsExpensesDate")),a=JSON.parse(localStorage.getItem("operationsIncomeDate")),localStorage.getItem("operationsExpensesDate")&&localStorage.getItem("operationsIncomeDate")?function(e,t){const a={};for(const o in e)t[o]?a[o]=[...e[o],...t[o]]:a[o]=e[o];for(const e in t)a[e]||(a[e]=t[e]);return a}(t,a):localStorage.getItem("operationsIncomeDate")?JSON.parse(localStorage.getItem("operationsIncomeDate")):localStorage.getItem("operationsExpensesDate")?JSON.parse(localStorage.getItem("operationsExpensesDate")):void 0);var t,a;localStorage.setItem("operationsAllDate",JSON.stringify(e))}()}(e.target.closest(".operation-list__item_expenses .item-category__button_delete"))}))})();